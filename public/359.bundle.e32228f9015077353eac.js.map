{"version":3,"file":"359.bundle.e32228f9015077353eac.js","mappings":"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","sources":["webpack:///../../../modes/tmtv/src/initToolGroups.js","webpack:///../../../modes/tmtv/src/toolbarButtons.js","webpack:///../../../modes/tmtv/src/id.js","webpack:///../../../modes/tmtv/src/index.js","webpack:///../../../modes/tmtv/src/utils/setCrosshairsConfiguration.js","webpack:///../../../modes/tmtv/src/utils/setFusionActiveVolume.js"],"sourcesContent":["export const toolGroupIds = {\r\n  CT: 'ctToolGroup',\r\n  PT: 'ptToolGroup',\r\n  Fusion: 'fusionToolGroup',\r\n  MIP: 'mipToolGroup',\r\n  default: 'default',\r\n  // MPR: 'mpr',\r\n};\r\n\r\nfunction _initToolGroups(toolNames, Enums, toolGroupService, commandsManager) {\r\n  const tools = {\r\n    active: [\r\n      {\r\n        toolName: toolNames.WindowLevel,\r\n        bindings: [{ mouseButton: Enums.MouseBindings.Primary }],\r\n      },\r\n      {\r\n        toolName: toolNames.Pan,\r\n        bindings: [{ mouseButton: Enums.MouseBindings.Auxiliary }],\r\n      },\r\n      {\r\n        toolName: toolNames.Zoom,\r\n        bindings: [{ mouseButton: Enums.MouseBindings.Secondary }],\r\n      },\r\n      { toolName: toolNames.StackScrollMouseWheel, bindings: [] },\r\n    ],\r\n    passive: [\r\n      { toolName: toolNames.Length },\r\n      {\r\n        toolName: toolNames.ArrowAnnotate,\r\n        configuration: {\r\n          getTextCallback: (callback, eventDetails) => {\r\n            commandsManager.runCommand('arrowTextCallback', {\r\n              callback,\r\n              eventDetails,\r\n            });\r\n          },\r\n\r\n          changeTextCallback: (data, eventDetails, callback) =>\r\n            commandsManager.runCommand('arrowTextCallback', {\r\n              callback,\r\n              data,\r\n              eventDetails,\r\n            }),\r\n        },\r\n      },\r\n      { toolName: toolNames.Bidirectional },\r\n      { toolName: toolNames.DragProbe },\r\n      { toolName: toolNames.Probe },\r\n      { toolName: toolNames.EllipticalROI },\r\n      { toolName: toolNames.RectangleROI },\r\n      { toolName: toolNames.StackScroll },\r\n      { toolName: toolNames.Angle },\r\n      { toolName: toolNames.CobbAngle },\r\n      { toolName: toolNames.Magnify },\r\n    ],\r\n    enabled: [{ toolName: toolNames.SegmentationDisplay }],\r\n    disabled: [\r\n      {\r\n        toolName: toolNames.Crosshairs,\r\n        configuration: {\r\n          viewportIndicators: false,\r\n          autoPan: {\r\n            enabled: false,\r\n            panSize: 10,\r\n          },\r\n        },\r\n      },\r\n    ],\r\n  };\r\n\r\n  toolGroupService.createToolGroupAndAddTools(toolGroupIds.CT, tools);\r\n  toolGroupService.createToolGroupAndAddTools(toolGroupIds.PT, {\r\n    active: tools.active,\r\n    passive: [...tools.passive, { toolName: 'RectangleROIStartEndThreshold' }],\r\n    enabled: tools.enabled,\r\n    disabled: tools.disabled,\r\n  });\r\n  toolGroupService.createToolGroupAndAddTools(toolGroupIds.Fusion, tools);\r\n  toolGroupService.createToolGroupAndAddTools(toolGroupIds.default, tools);\r\n\r\n  const mipTools = {\r\n    active: [\r\n      {\r\n        toolName: toolNames.VolumeRotateMouseWheel,\r\n        configuration: {\r\n          rotateIncrementDegrees: 0.1,\r\n        },\r\n      },\r\n      {\r\n        toolName: toolNames.MipJumpToClick,\r\n        configuration: {\r\n          toolGroupId: toolGroupIds.PT,\r\n        },\r\n        bindings: [{ mouseButton: Enums.MouseBindings.Primary }],\r\n      },\r\n    ],\r\n    enabled: [{ toolName: toolNames.SegmentationDisplay }],\r\n  };\r\n\r\n  toolGroupService.createToolGroupAndAddTools(toolGroupIds.MIP, mipTools);\r\n}\r\n\r\nfunction initToolGroups(toolNames, Enums, toolGroupService, commandsManager) {\r\n  _initToolGroups(toolNames, Enums, toolGroupService, commandsManager);\r\n}\r\n\r\nexport default initToolGroups;\r\n","// TODO: torn, can either bake this here; or have to create a whole new button type\r\n// Only ways that you can pass in a custom React component for render :l\r\nimport { WindowLevelMenuItem } from '@ohif/ui';\r\nimport { defaults } from '@ohif/core';\r\nimport { toolGroupIds } from './initToolGroups';\r\nconst { windowLevelPresets } = defaults;\r\n/**\r\n *\r\n * @param {*} type - 'tool' | 'action' | 'toggle'\r\n * @param {*} id\r\n * @param {*} icon\r\n * @param {*} label\r\n */\r\nfunction _createButton(type, id, icon, label, commands, tooltip) {\r\n  return {\r\n    id,\r\n    icon,\r\n    label,\r\n    type,\r\n    commands,\r\n    tooltip,\r\n  };\r\n}\r\n\r\nfunction _createColormap(label, colormap) {\r\n  return {\r\n    id: label,\r\n    label,\r\n    type: 'action',\r\n    commands: [\r\n      {\r\n        commandName: 'setFusionPTColormap',\r\n        commandOptions: {\r\n          toolGroupId: toolGroupIds.Fusion,\r\n          colormap,\r\n        },\r\n      },\r\n    ],\r\n  };\r\n}\r\n\r\nconst _createActionButton = _createButton.bind(null, 'action');\r\nconst _createToggleButton = _createButton.bind(null, 'toggle');\r\nconst _createToolButton = _createButton.bind(null, 'tool');\r\n\r\n/**\r\n *\r\n * @param {*} preset - preset number (from above import)\r\n * @param {*} title\r\n * @param {*} subtitle\r\n */\r\nfunction _createWwwcPreset(preset, title, subtitle) {\r\n  return {\r\n    id: preset.toString(),\r\n    title,\r\n    subtitle,\r\n    type: 'action',\r\n    commands: [\r\n      {\r\n        commandName: 'setWindowLevel',\r\n        commandOptions: {\r\n          ...windowLevelPresets[preset],\r\n        },\r\n        context: 'CORNERSTONE',\r\n      },\r\n    ],\r\n  };\r\n}\r\n\r\nfunction _createCommands(commandName, toolName, toolGroupIds) {\r\n  return toolGroupIds.map(toolGroupId => ({\r\n    /* It's a command that is being run when the button is clicked. */\r\n    commandName,\r\n    commandOptions: {\r\n      toolName,\r\n      toolGroupId,\r\n    },\r\n    context: 'CORNERSTONE',\r\n  }));\r\n}\r\n\r\nconst toolbarButtons = [\r\n  // Measurement\r\n  {\r\n    id: 'MeasurementTools',\r\n    type: 'ohif.splitButton',\r\n    props: {\r\n      groupId: 'MeasurementTools',\r\n      isRadio: true, // ?\r\n      // Switch?\r\n      primary: _createToolButton(\r\n        'Length',\r\n        'tool-length',\r\n        'Length',\r\n        [\r\n          ..._createCommands('setToolActive', 'Length', [\r\n            toolGroupIds.CT,\r\n            toolGroupIds.PT,\r\n            toolGroupIds.Fusion,\r\n            // toolGroupIds.MPR,\r\n          ]),\r\n        ],\r\n        'Length'\r\n      ),\r\n      secondary: {\r\n        icon: 'chevron-down',\r\n        label: '',\r\n        isActive: true,\r\n        tooltip: 'More Measure Tools',\r\n      },\r\n      items: [\r\n        _createToolButton(\r\n          'Length',\r\n          'tool-length',\r\n          'Length',\r\n          [\r\n            ..._createCommands('setToolActive', 'Length', [\r\n              toolGroupIds.CT,\r\n              toolGroupIds.PT,\r\n              toolGroupIds.Fusion,\r\n              // toolGroupIds.MPR,\r\n            ]),\r\n          ],\r\n          'Length Tool'\r\n        ),\r\n        _createToolButton(\r\n          'Bidirectional',\r\n          'tool-bidirectional',\r\n          'Bidirectional',\r\n          [\r\n            ..._createCommands('setToolActive', 'Bidirectional', [\r\n              toolGroupIds.CT,\r\n              toolGroupIds.PT,\r\n              toolGroupIds.Fusion,\r\n              // toolGroupIds.MPR,\r\n            ]),\r\n          ],\r\n          'Bidirectional Tool'\r\n        ),\r\n        _createToolButton(\r\n          'ArrowAnnotate',\r\n          'tool-annotate',\r\n          'Annotation',\r\n          [\r\n            ..._createCommands('setToolActive', 'ArrowAnnotate', [\r\n              toolGroupIds.CT,\r\n              toolGroupIds.PT,\r\n              toolGroupIds.Fusion,\r\n              // toolGroupIds.MPR,\r\n            ]),\r\n          ],\r\n          'Arrow Annotate'\r\n        ),\r\n        _createToolButton(\r\n          'EllipticalROI',\r\n          'tool-elipse',\r\n          'Ellipse',\r\n          [\r\n            ..._createCommands('setToolActive', 'EllipticalROI', [\r\n              toolGroupIds.CT,\r\n              toolGroupIds.PT,\r\n              toolGroupIds.Fusion,\r\n              // toolGroupIds.MPR,\r\n            ]),\r\n          ],\r\n          'Ellipse Tool'\r\n        ),\r\n      ],\r\n    },\r\n  },\r\n  // Zoom..\r\n  {\r\n    id: 'Zoom',\r\n    type: 'ohif.radioGroup',\r\n    props: {\r\n      type: 'tool',\r\n      icon: 'tool-zoom',\r\n      label: 'Zoom',\r\n      commands: [\r\n        ..._createCommands('setToolActive', 'Zoom', [\r\n          toolGroupIds.CT,\r\n          toolGroupIds.PT,\r\n          toolGroupIds.Fusion,\r\n          // toolGroupIds.MPR,\r\n        ]),\r\n      ],\r\n    },\r\n  },\r\n  {\r\n    id: 'MPR',\r\n    type: 'ohif.action',\r\n    props: {\r\n      type: 'toggle',\r\n      icon: 'icon-mpr',\r\n      label: 'MPR',\r\n      commands: [\r\n        {\r\n          commandName: 'toggleHangingProtocol',\r\n          commandOptions: {\r\n            protocolId: 'mpr',\r\n          },\r\n          context: 'DEFAULT',\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  // Window Level + Presets...\r\n  {\r\n    id: 'WindowLevel',\r\n    type: 'ohif.splitButton',\r\n    props: {\r\n      groupId: 'WindowLevel',\r\n      primary: _createToolButton(\r\n        'WindowLevel',\r\n        'tool-window-level',\r\n        'Window Level',\r\n        [\r\n          ..._createCommands('setToolActive', 'WindowLevel', [\r\n            toolGroupIds.CT,\r\n            toolGroupIds.PT,\r\n            toolGroupIds.Fusion,\r\n            // toolGroupIds.MPR,\r\n          ]),\r\n        ],\r\n        'Window Level'\r\n      ),\r\n      secondary: {\r\n        icon: 'chevron-down',\r\n        label: 'W/L Manual',\r\n        isActive: true,\r\n        tooltip: 'W/L Presets',\r\n      },\r\n      isAction: true, // ?\r\n      renderer: WindowLevelMenuItem,\r\n      items: [\r\n        _createWwwcPreset(1, 'Soft tissue', '400 / 40'),\r\n        _createWwwcPreset(2, 'Lung', '1500 / -600'),\r\n        _createWwwcPreset(3, 'Liver', '150 / 90'),\r\n        _createWwwcPreset(4, 'Bone', '2500 / 480'),\r\n        _createWwwcPreset(5, 'Brain', '80 / 40'),\r\n      ],\r\n    },\r\n  },\r\n  {\r\n    id: 'Crosshairs',\r\n    type: 'ohif.radioGroup',\r\n    props: {\r\n      type: 'tool',\r\n      icon: 'tool-crosshair',\r\n      label: 'Crosshairs',\r\n      commands: [\r\n        ..._createCommands('setToolActive', 'Crosshairs', [\r\n          toolGroupIds.CT,\r\n          toolGroupIds.PT,\r\n          toolGroupIds.Fusion,\r\n          // toolGroupIds.MPR,\r\n        ]),\r\n      ],\r\n    },\r\n  },\r\n  // Pan...\r\n  {\r\n    id: 'Pan',\r\n    type: 'ohif.radioGroup',\r\n    props: {\r\n      type: 'tool',\r\n      icon: 'tool-move',\r\n      label: 'Pan',\r\n      commands: [\r\n        ..._createCommands('setToolActive', 'Pan', [\r\n          toolGroupIds.CT,\r\n          toolGroupIds.PT,\r\n          toolGroupIds.Fusion,\r\n          // toolGroupIds.MPR,\r\n        ]),\r\n      ],\r\n    },\r\n  },\r\n  {\r\n    id: 'RectangleROIStartEndThreshold',\r\n    type: 'ohif.radioGroup',\r\n    props: {\r\n      type: 'tool',\r\n      icon: 'tool-create-threshold',\r\n      label: 'Rectangle ROI Threshold',\r\n      commands: [\r\n        ..._createCommands('setToolActive', 'RectangleROIStartEndThreshold', [toolGroupIds.PT]),\r\n        {\r\n          commandName: 'displayNotification',\r\n          commandOptions: {\r\n            title: 'RectangleROI Threshold Tip',\r\n            text: 'RectangleROI Threshold tool should be used on PT Axial Viewport',\r\n            type: 'info',\r\n          },\r\n        },\r\n        {\r\n          commandName: 'setViewportActive',\r\n          commandOptions: {\r\n            viewportId: 'ptAXIAL',\r\n          },\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  {\r\n    id: 'fusionPTColormap',\r\n    type: 'ohif.splitButton',\r\n    props: {\r\n      groupId: 'fusionPTColormap',\r\n      primary: _createToolButton(\r\n        'fusionPTColormap',\r\n        'tool-fusion-color',\r\n        'Fusion PT Colormap',\r\n        [],\r\n        'Fusion PT Colormap'\r\n      ),\r\n      secondary: {\r\n        icon: 'chevron-down',\r\n        label: 'PT Colormap',\r\n        isActive: true,\r\n        tooltip: 'PET Image Colormap',\r\n      },\r\n      isAction: true, // ?\r\n      items: [\r\n        _createColormap('HSV', 'hsv'),\r\n        _createColormap('Hot Iron', 'hot_iron'),\r\n        _createColormap('S PET', 's_pet'),\r\n        _createColormap('Red Hot', 'red_hot'),\r\n        _createColormap('Perfusion', 'perfusion'),\r\n        _createColormap('Rainbow', 'rainbow_2'),\r\n        _createColormap('SUV', 'suv'),\r\n        _createColormap('GE 256', 'ge_256'),\r\n        _createColormap('GE', 'ge'),\r\n        _createColormap('Siemens', 'siemens'),\r\n      ],\r\n    },\r\n  },\r\n];\r\n\r\nexport default toolbarButtons;\r\n","import packageJson from '../package.json';\r\n\r\nconst id = packageJson.name;\r\n\r\nexport { id };\r\n","import { hotkeys, classes } from '@ohif/core';\r\nimport toolbarButtons from './toolbarButtons.js';\r\nimport { id } from './id.js';\r\nimport initToolGroups, { toolGroupIds } from './initToolGroups.js';\r\nimport setCrosshairsConfiguration from './utils/setCrosshairsConfiguration.js';\r\nimport setFusionActiveVolume from './utils/setFusionActiveVolume.js';\r\n\r\nconst { MetadataProvider } = classes;\r\n\r\nconst ohif = {\r\n  layout: '@ohif/extension-default.layoutTemplateModule.viewerLayout',\r\n  sopClassHandler: '@ohif/extension-default.sopClassHandlerModule.stack',\r\n  measurements: '@ohif/extension-default.panelModule.measure',\r\n  thumbnailList: '@ohif/extension-default.panelModule.seriesList',\r\n};\r\n\r\nconst cs3d = {\r\n  viewport: '@ohif/extension-cornerstone.viewportModule.cornerstone',\r\n};\r\n\r\nconst tmtv = {\r\n  hangingProtocol: '@ohif/extension-tmtv.hangingProtocolModule.ptCT',\r\n  petSUV: '@ohif/extension-tmtv.panelModule.petSUV',\r\n  ROIThresholdPanel: '@ohif/extension-tmtv.panelModule.ROIThresholdSeg',\r\n};\r\n\r\nconst extensionDependencies = {\r\n  // Can derive the versions at least process.env.from npm_package_version\r\n  '@ohif/extension-default': '^3.0.0',\r\n  '@ohif/extension-cornerstone': '^3.0.0',\r\n  '@ohif/extension-tmtv': '^3.0.0',\r\n};\r\n\r\nlet unsubscriptions = [];\r\nfunction modeFactory({ modeConfiguration }) {\r\n  return {\r\n    // TODO: We're using this as a route segment\r\n    // We should not be.\r\n    id,\r\n    routeName: 'tmtv',\r\n    displayName: 'Total Metabolic Tumor Volume',\r\n    /**\r\n     * Lifecycle hooks\r\n     */\r\n    onModeEnter: ({ servicesManager, extensionManager, commandsManager }) => {\r\n      const { toolbarService, toolGroupService, hangingProtocolService, displaySetService } =\r\n        servicesManager.services;\r\n\r\n      const utilityModule = extensionManager.getModuleEntry(\r\n        '@ohif/extension-cornerstone.utilityModule.tools'\r\n      );\r\n\r\n      const { toolNames, Enums } = utilityModule.exports;\r\n\r\n      // Init Default and SR ToolGroups\r\n      initToolGroups(toolNames, Enums, toolGroupService, commandsManager);\r\n\r\n      const setWindowLevelActive = () => {\r\n        toolbarService.recordInteraction({\r\n          groupId: 'WindowLevel',\r\n          interactionType: 'tool',\r\n          commands: [\r\n            {\r\n              commandName: 'setToolActive',\r\n              commandOptions: {\r\n                toolName: toolNames.WindowLevel,\r\n                toolGroupId: toolGroupIds.CT,\r\n              },\r\n              context: 'CORNERSTONE',\r\n            },\r\n            {\r\n              commandName: 'setToolActive',\r\n              commandOptions: {\r\n                toolName: toolNames.WindowLevel,\r\n                toolGroupId: toolGroupIds.PT,\r\n              },\r\n              context: 'CORNERSTONE',\r\n            },\r\n            {\r\n              commandName: 'setToolActive',\r\n              commandOptions: {\r\n                toolName: toolNames.WindowLevel,\r\n                toolGroupId: toolGroupIds.Fusion,\r\n              },\r\n              context: 'CORNERSTONE',\r\n            },\r\n          ],\r\n        });\r\n      };\r\n\r\n      const { unsubscribe } = toolGroupService.subscribe(\r\n        toolGroupService.EVENTS.VIEWPORT_ADDED,\r\n        () => {\r\n          // For fusion toolGroup we need to add the volumeIds for the crosshairs\r\n          // since in the fusion viewport we don't want both PT and CT to render MIP\r\n          // when slabThickness is modified\r\n          const { displaySetMatchDetails } = hangingProtocolService.getMatchDetails();\r\n\r\n          setCrosshairsConfiguration(\r\n            displaySetMatchDetails,\r\n            toolNames,\r\n            toolGroupService,\r\n            displaySetService\r\n          );\r\n\r\n          setFusionActiveVolume(\r\n            displaySetMatchDetails,\r\n            toolNames,\r\n            toolGroupService,\r\n            displaySetService\r\n          );\r\n\r\n          setWindowLevelActive();\r\n        }\r\n      );\r\n\r\n      unsubscriptions.push(unsubscribe);\r\n      toolbarService.init(extensionManager);\r\n      toolbarService.addButtons(toolbarButtons);\r\n      toolbarService.createButtonSection('primary', [\r\n        'MeasurementTools',\r\n        'Zoom',\r\n        'WindowLevel',\r\n        'Crosshairs',\r\n        'Pan',\r\n        'RectangleROIStartEndThreshold',\r\n        'fusionPTColormap',\r\n      ]);\r\n\r\n      // For the hanging protocol we need to decide on the window level\r\n      // based on whether the SUV is corrected or not, hence we can't hard\r\n      // code the window level in the hanging protocol but we add a custom\r\n      // attribute to the hanging protocol that will be used to get the\r\n      // window level based on the metadata\r\n      hangingProtocolService.addCustomAttribute(\r\n        'getPTVOIRange',\r\n        'get PT VOI based on corrected or not',\r\n        props => {\r\n          const ptDisplaySet = props.find(imageSet => imageSet.Modality === 'PT');\r\n\r\n          if (!ptDisplaySet) {\r\n            return;\r\n          }\r\n\r\n          const { imageId } = ptDisplaySet.images[0];\r\n          const imageIdScalingFactor = MetadataProvider.get('scalingModule', imageId);\r\n\r\n          const isSUVAvailable = imageIdScalingFactor && imageIdScalingFactor.suvbw;\r\n\r\n          if (isSUVAvailable) {\r\n            return {\r\n              windowWidth: 5,\r\n              windowCenter: 2.5,\r\n            };\r\n          }\r\n\r\n          return;\r\n        }\r\n      );\r\n    },\r\n    onModeExit: ({ servicesManager }) => {\r\n      const {\r\n        toolGroupService,\r\n        syncGroupService,\r\n        segmentationService,\r\n        cornerstoneViewportService,\r\n      } = servicesManager.services;\r\n\r\n      unsubscriptions.forEach(unsubscribe => unsubscribe());\r\n      toolGroupService.destroy();\r\n      syncGroupService.destroy();\r\n      segmentationService.destroy();\r\n      cornerstoneViewportService.destroy();\r\n    },\r\n    validationTags: {\r\n      study: [],\r\n      series: [],\r\n    },\r\n    isValidMode: ({ modalities, study }) => {\r\n      const modalities_list = modalities.split('\\\\');\r\n      const invalidModalities = ['SM'];\r\n\r\n      const isValid =\r\n        modalities_list.includes('CT') &&\r\n        modalities_list.includes('PT') &&\r\n        !invalidModalities.some(modality => modalities_list.includes(modality)) &&\r\n        // This is study is a 4D study with PT and CT and not a 3D study for the tmtv\r\n        // mode, until we have a better way to identify 4D studies we will use the\r\n        // StudyInstanceUID to identify the study\r\n        // Todo: when we add the 4D mode which comes with a mechanism to identify\r\n        // 4D studies we can use that\r\n        study.studyInstanceUid !== '1.3.6.1.4.1.12842.1.1.14.3.20220915.105557.468.2963630849';\r\n\r\n      // there should be both CT and PT modalities and the modality should not be SM\r\n      return isValid;\r\n    },\r\n    routes: [\r\n      {\r\n        path: 'tmtv',\r\n        /*init: ({ servicesManager, extensionManager }) => {\r\n          //defaultViewerRouteInit\r\n        },*/\r\n        layoutTemplate: ({ location, servicesManager }) => {\r\n          return {\r\n            id: ohif.layout,\r\n            props: {\r\n              leftPanels: [ohif.thumbnailList],\r\n              leftPanelDefaultClosed: true,\r\n              rightPanels: [tmtv.ROIThresholdPanel, tmtv.petSUV],\r\n              viewports: [\r\n                {\r\n                  namespace: cs3d.viewport,\r\n                  displaySetsToDisplay: [ohif.sopClassHandler],\r\n                },\r\n              ],\r\n            },\r\n          };\r\n        },\r\n      },\r\n    ],\r\n    extensions: extensionDependencies,\r\n    hangingProtocol: tmtv.hangingProtocol,\r\n    sopClassHandlers: [ohif.sopClassHandler],\r\n    hotkeys: [...hotkeys.defaults.hotkeyBindings],\r\n    ...modeConfiguration,\r\n  };\r\n}\r\n\r\nconst mode = {\r\n  id,\r\n  modeFactory,\r\n  extensionDependencies,\r\n};\r\n\r\nexport default mode;\r\n","import { toolGroupIds } from '../initToolGroups';\r\n\r\nexport default function setCrosshairsConfiguration(\r\n  matches,\r\n  toolNames,\r\n  toolGroupService,\r\n  displaySetService\r\n) {\r\n  const matchDetails = matches.get('ctDisplaySet');\r\n\r\n  if (!matchDetails) {\r\n    return;\r\n  }\r\n\r\n  const { SeriesInstanceUID } = matchDetails;\r\n  const displaySets = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID);\r\n\r\n  const toolConfig = toolGroupService.getToolConfiguration(\r\n    toolGroupIds.Fusion,\r\n    toolNames.Crosshairs\r\n  );\r\n\r\n  const crosshairsConfig = {\r\n    ...toolConfig,\r\n    filterActorUIDsToSetSlabThickness: [displaySets[0].displaySetInstanceUID],\r\n  };\r\n\r\n  toolGroupService.setToolConfiguration(\r\n    toolGroupIds.Fusion,\r\n    toolNames.Crosshairs,\r\n    crosshairsConfig\r\n  );\r\n}\r\n","import { toolGroupIds } from '../initToolGroups';\r\n\r\nexport default function setFusionActiveVolume(\r\n  matches,\r\n  toolNames,\r\n  toolGroupService,\r\n  displaySetService\r\n) {\r\n  const matchDetails = matches.get('ptDisplaySet');\r\n\r\n  if (!matchDetails) {\r\n    return;\r\n  }\r\n\r\n  const { SeriesInstanceUID } = matchDetails;\r\n\r\n  const displaySets = displaySetService.getDisplaySetsForSeries(SeriesInstanceUID);\r\n\r\n  if (!displaySets || displaySets.length === 0) {\r\n    return;\r\n  }\r\n\r\n  const wlToolConfig = toolGroupService.getToolConfiguration(\r\n    toolGroupIds.Fusion,\r\n    toolNames.WindowLevel\r\n  );\r\n\r\n  const ellipticalToolConfig = toolGroupService.getToolConfiguration(\r\n    toolGroupIds.Fusion,\r\n    toolNames.EllipticalROI\r\n  );\r\n\r\n  // Todo: this should not take into account the loader id\r\n  const volumeId = `cornerstoneStreamingImageVolume:${displaySets[0].displaySetInstanceUID}`;\r\n\r\n  const windowLevelConfig = {\r\n    ...wlToolConfig,\r\n    volumeId,\r\n  };\r\n\r\n  const ellipticalROIConfig = {\r\n    ...ellipticalToolConfig,\r\n    volumeId,\r\n  };\r\n\r\n  toolGroupService.setToolConfiguration(\r\n    toolGroupIds.Fusion,\r\n    toolNames.WindowLevel,\r\n    windowLevelConfig\r\n  );\r\n\r\n  toolGroupService.setToolConfiguration(\r\n    toolGroupIds.Fusion,\r\n    toolNames.EllipticalROI,\r\n    ellipticalROIConfig\r\n  );\r\n}\r\n"],"names":["toolGroupIds","CT","PT","Fusion","MIP","default","toolNames","Enums","toolGroupService","commandsManager","tools","active","toolName","WindowLevel","bindings","mouseButton","MouseBindings","Primary","Pan","Auxiliary","Zoom","Secondary","StackScrollMouseWheel","passive","Length","ArrowAnnotate","configuration","getTextCallback","callback","eventDetails","runCommand","changeTextCallback","data","Bidirectional","DragProbe","Probe","EllipticalROI","RectangleROI","StackScroll","Angle","CobbAngle","Magnify","enabled","SegmentationDisplay","disabled","Crosshairs","viewportIndicators","autoPan","panSize","createToolGroupAndAddTools","mipTools","VolumeRotateMouseWheel","rotateIncrementDegrees","MipJumpToClick","toolGroupId","_initToolGroups","windowLevelPresets","defaults","_createButton","type","id","icon","label","commands","tooltip","_createColormap","colormap","commandName","commandOptions","bind","_createToolButton","_createWwwcPreset","preset","title","subtitle","toString","context","_createCommands","map","props","groupId","isRadio","primary","secondary","isActive","items","protocolId","isAction","renderer","WindowLevelMenuItem","text","viewportId","packageJson","MetadataProvider","classes","ohif","cs3d","tmtv","extensionDependencies","unsubscriptions","modeFactory","_ref","modeConfiguration","routeName","displayName","onModeEnter","_ref2","servicesManager","extensionManager","toolbarService","hangingProtocolService","displaySetService","services","utilityModule","getModuleEntry","exports","initToolGroups","unsubscribe","subscribe","EVENTS","VIEWPORT_ADDED","displaySetMatchDetails","getMatchDetails","matches","matchDetails","get","SeriesInstanceUID","displaySets","getDisplaySetsForSeries","crosshairsConfig","getToolConfiguration","filterActorUIDsToSetSlabThickness","displaySetInstanceUID","setToolConfiguration","setCrosshairsConfiguration","length","wlToolConfig","ellipticalToolConfig","volumeId","windowLevelConfig","ellipticalROIConfig","setFusionActiveVolume","recordInteraction","interactionType","push","init","addButtons","toolbarButtons","createButtonSection","addCustomAttribute","ptDisplaySet","find","imageSet","Modality","imageId","images","imageIdScalingFactor","suvbw","windowWidth","windowCenter","onModeExit","_ref3","syncGroupService","segmentationService","cornerstoneViewportService","forEach","destroy","validationTags","study","series","isValidMode","_ref4","modalities","modalities_list","split","includes","some","modality","studyInstanceUid","routes","path","layoutTemplate","_ref5","location","leftPanels","leftPanelDefaultClosed","rightPanels","viewports","namespace","displaySetsToDisplay","extensions","hangingProtocol","sopClassHandlers","hotkeys","hotkeyBindings"],"sourceRoot":""}